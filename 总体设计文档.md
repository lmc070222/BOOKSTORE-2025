# 总体设计文档

## 项目名称 / 文档作者

- **项目名称**：书店管理系统  
- **文档作者**：刘劢辰

---

## 程序功能概述

书店管理系统是一个面向书店管理、帐户管理和图书交易的命令行系统。该系统提供如下核心功能：
1. **帐户系统**：允许用户注册、登录、修改密码、管理帐户权限等。
2. **图书系统**：包括图书信息的检索、选择、修改、购买、进货等功能。
3. **日志系统**：记录系统运行中的操作与交易信息，支持财务查询与员工工作情况报告。

系统的核心目标是通过文件存储管理帐户、图书及交易信息，以保证数据持久性。

---

## 主体逻辑说明

系统启动时，首先会进行帐户和图书数据的初始化。超级管理员账户 `root` 会自动创建，所有其他账户的操作都需要在权限控制下进行。

- **登录栈**：用户可以登录多个帐户，系统会按照最后登录的帐户执行命令。
- **指令解析**：系统根据命令行输入的指令，解析并执行相应的操作。如果输入非法命令或格式不对，系统返回错误信息。

---

## 代码文件结构
bookstore/
│
├── main.cpp // 主函数，负责启动和调度
├── account_manager.cpp // 帐户管理功能实现
├── book_manager.cpp // 图书管理功能实现
├── log_manager.cpp // 日志管理功能实现
├── utils.cpp // 辅助函数，包括文件操作和输入验证
├── database/ // 存储文件夹
│ ├── accounts.dat // 存储帐户信息
│ ├── books.dat // 存储图书信息
│ └── transactions.dat // 存储交易信息
├── account_manager.h // 帐户管理功能声明
├── book_manager.h // 图书管理功能声明
├── log_manager.h // 日志管理功能声明
└── utils.h // 辅助函数声明



- **main.cpp**：程序的入口点，负责初始化和管理不同模块。
- **account_manager.cpp**、**book_manager.cpp**、**log_manager.cpp**：分别处理帐户、图书和日志系统的业务逻辑。
- **utils.cpp**：包括文件读写、输入验证等通用功能。
- **database**：用于存储系统数据（如帐户信息、图书信息等）。

---

## 功能设计

### **帐户系统**

1. **功能结构图**：

帐户管理
├── 登录（su）
├── 注销（logout）
├── 注册（register）
├── 修改密码（passwd）
├── 创建帐户（useradd）
├── 删除帐户（delete）


2. **功能描述**：
- **登录**：用户输入 `su [UserID] [Password]`，通过验证帐户信息后进入系统。
- **注销**：用户输入 `logout` 退出当前登录帐户。
- **注册**：用户输入 `register [UserID] [Password] [Username]`，创建新的帐户。
- **修改密码**：通过 `passwd` 指令，用户可以修改自己或他人的密码，依据权限不同。
- **创建帐户**：管理员可以使用 `useradd` 创建具有指定权限的新帐户。
- **删除帐户**：仅超级管理员可以删除帐户，使用 `delete [UserID]`。

### **图书系统**

1. **功能结构图**：

图书管理
├── 显示图书信息（show）
├── 购买图书（buy）
├── 选择图书（select）
├── 修改图书信息（modify）
└── 图书进货（import）


2. **功能描述**：
- **显示图书信息**：用户可以通过 `show` 指令查询图书，根据 ISBN、书名、作者或关键词进行筛选。
- **购买图书**：用户输入 `buy [ISBN] [Quantity]`，购买指定数量的图书，减少库存。
- **选择图书**：管理员可以使用 `select` 选择并管理特定图书，选择后可以修改图书信息或进货。
- **修改图书信息**：管理员可以使用 `modify` 修改已选择图书的相关信息（如 ISBN、书名、作者等）。
- **图书进货**：管理员通过 `import` 增加图书库存，指定数量和交易金额。

### **日志系统**

1. **功能结构图**：

日志管理
├── 查询财务记录（show finance）
├── 生成财务报告（report finance）
├── 生成员工工作报告（report employee）
└── 日志记录（log）


2. **功能描述**：
- **查询财务记录**：管理员通过 `show finance` 查询一定数量的交易记录。
- **生成财务报告**：通过 `report finance`，系统生成财务报告，展示收入和支出。
- **生成员工工作报告**：通过 `report employee`，生成所有员工的工作情况报告。
- **日志记录**：管理员通过 `log` 获取系统运行的详细日志，包含操作和交易信息。

---

## 数据库设计

1. **帐户数据库（accounts.dat）**：
- 数据格式：每条记录包含 `UserID`、`Password`、`Username`、`Privilege`。
- 存储方式：按行存储，使用逗号分隔每个字段。

2. **图书数据库（books.dat）**：
- 数据格式：每本书的记录包含 `ISBN`、`BookName`、`Author`、`Keyword`、`Price`、`Quantity`。
- 存储方式：按行存储，字段之间使用制表符或逗号分隔。

3. **交易数据库（transactions.dat）**：
- 数据格式：每条记录包含 `TransactionID`、`ISBN`、`Quantity`、`TotalCost`、`Date`。
- 存储方式：按行存储，字段之间使用制表符或逗号分隔。

---

## 类、结构体设计

### **类设计**

1. **AccountManager**：
- 负责管理帐户的注册、登录、注销、密码修改等操作。
- 成员变量：`accounts`（帐户列表），`currentUser`（当前登录的用户）。

2. **BookManager**：
- 负责图书的显示、选择、修改、进货等操作。
- 成员变量：`books`（图书列表），`selectedBook`（当前选择的图书）。

3. **LogManager**：
- 负责记录和查询系统日志和财务日志。
- 成员变量：`logRecords`（日志记录列表），`financeRecords`（财务记录列表）。

### **结构体设计**

- **Account**：结构体包含 `UserID`、`Password`、`Privilege` 等成员变量。
- **Book**：结构体包含 `ISBN`、`BookName`、`Author`、`Keyword`、`Price`、`Quantity` 等成员变量。
- **Transaction**：结构体包含 `TransactionID`、`ISBN`、`Quantity`、`TotalCost`、`Date` 等成员变量。

---

## 其他补充说明

1. **程序运行时数据初始化**：
- 系统首次运行时会自动创建一个超级管理员帐户 `root`，密码为 `sjtu`，权限为 {7}。
- 数据会存储在文件中，系统每次启动时都会从文件中加载数据。

2. **性能优化**：
- 所有数据的读写都会实时操作文件，以避免内存过大导致的问题。
- 数据存储文件总数不超过 20 个，避免过多文件影响性能。

3. **安全性和权限管理**：
- 系统根据不同用户权限控制其可以执行的操作。权限低的用户无法执行超出其权限范围的操作。

---



